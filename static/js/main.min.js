function getRandomInt(e,r){return Math.floor(Math.random()*(r-e+1)+e)}function getRandomGreenColor(){return Math.floor(10*Math.random())}function generate(e){var r=1,t=1,a=3,s=3,n=2,o=-2,i=6,l=20,d=5,p=MIN_HEIGHT,E=15,c=0,y=[8091938,13552661,13489924,10664979,8756263,6717460,12510548,13479168,9139456,11451217];cubes=[];for(var m=0;e>m;m++){var u=getRandomInt(t,a);cubes[m]=new Physijs.BoxMesh(new THREE.BoxGeometry(u,r,s),new THREE.MeshLambertMaterial({color:y[getRandomGreenColor()]}),0),cubes[m].position.x=E,cubes[m].position.y=c,0==m&&(cubes[m].scale.x=20/u,cubes[m].position.x-=9),m==e-1&&(cubes[m].material.color=cubes[0].material.color,cubes[m].scale.x=20/u,cubes[m].position.x+=9),scene.add(cubes[m]),c+=getRandomInt(o,n),l=getRandomInt(u,i),E+=l,p>c&&(c=p),c>d&&(c=d)}return 0}function init(){clock=new THREE.Clock,renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0,alpha:!0}):new THREE.CanvasRenderer,renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),DEBUG&&(render_stats=new Stats,render_stats.domElement.style.position="absolute",render_stats.domElement.style.top="1px",render_stats.domElement.style.zIndex=100,document.body.appendChild(render_stats.domElement),physics_stats=new Stats,physics_stats.domElement.style.position="absolute",physics_stats.domElement.style.top="50px",physics_stats.domElement.style.zIndex=100,document.body.appendChild(physics_stats.domElement)),scene=new Physijs.Scene,scene.setGravity(new THREE.Vector3(0,-GRAVITY,0)),scene.addEventListener("update",function(){player.setAngularVelocity(new THREE.Vector3(0,0,0)),PAUSE||scene.simulate(void 0,1),DEBUG&&physics_stats.update()}),camera=new THREE.PerspectiveCamera(FOV,window.innerWidth/window.innerHeight,1,1e4),camera.position.set(0,7,4),camera.rotation.x=-.5,keyboard=new THREEx.KeyboardState;var e=new THREE.AmbientLight(15790320);scene.add(e);var r=new THREE.DirectionalLight(16777215,.5);r.position.set(0,1,0),scene.add(r),player=new Physijs.BoxMesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshPhongMaterial({color:9091072})),player.addEventListener("collision",function(e){e==cubes[LVL_LENGTH-1]&&($(".victory").removeClass("hidden"),VICTORY=!0,PAUSE=!0),play(sounds.collision),force=BOUNCE_HEIGHT,player.isJumping&&(play(sounds.jump),force+=player.jumpForce,player.jumpForce=MIN_JUMP_HEIGHT),this.applyCentralImpulse(new THREE.Vector3(0,force,0)),this.setAngularVelocity(new THREE.Vector3(0,0,0)),this.isJumping=!1}),player.position.y=PLAYER_OFFSET,player.isJumping=!1,player.onGround=!0,scene.add(player),generate(LVL_LENGTH),requestAnimationFrame(render),scene.simulate()}function render(){requestAnimationFrame(render),player.position.y<-2&&($(".defeat").removeClass("hidden"),keyboard.pressed("r")&&reset(!1)),VICTORY&&keyboard.pressed("r")&&(reset(!0),PAUSE=!1,scene.simulate(void 0,1)),delta=clock.getDelta(),v=player.getLinearVelocity(),keyboard.pressed("w")||keyboard.pressed("up")||keyboard.pressed("space")?(player.jumpForce<MAX_JUMP_HEIGHT&&(player.jumpForce+=JUMP_RATE*delta),player.isJumping=!1,v.x>0?player.applyCentralImpulse(new THREE.Vector3(-MOVE_SPEED*delta,0,0)):player.applyCentralImpulse(new THREE.Vector3(MOVE_SPEED*delta,0,0))):(player.jumpForce!=MIN_JUMP_HEIGHT&&(player.isJumping=!0),keyboard.pressed("a")||keyboard.pressed("left")?Math.abs(v.x)<MAX_VELOCITY&&player.applyCentralImpulse(new THREE.Vector3(-MOVE_SPEED*delta,0,0)):keyboard.pressed("d")||keyboard.pressed("right")?Math.abs(v.x)<MAX_VELOCITY&&player.applyCentralImpulse(new THREE.Vector3(MOVE_SPEED*delta,0,0)):v.x>0?player.applyCentralImpulse(new THREE.Vector3(-MOVE_SPEED*delta,0,0)):player.applyCentralImpulse(new THREE.Vector3(MOVE_SPEED*delta,0,0))),camera.position.x=player.position.x,renderer.autoClear=!1,renderer.clear(),renderer.render(scene,camera),DEBUG&&render_stats.update()}function reset(e){if(e){for(var r=0;LVL_LENGTH>r;r++)scene.remove(cubes[r]);cubes=null,generate(LVL_LENGTH)}player.setLinearVelocity(new THREE.Vector3(0,0,0)),player.position.set(0,PLAYER_OFFSET,0),player.__dirtyPosition=!0,player.rotation.set(0,0,0),player.__dirtyRotation=!0,$(".defeat").addClass("hidden"),$(".victory").addClass("hidden"),VICTORY=!1}var scene,camera,renderer,keyboard,clock,cubes,player,death_plane;Physijs.scripts.worker="static/js/physijs_worker.js",Physijs.scripts.ammo="ammo.js";var DEBUG=!1,MOVE_SPEED=10,MIN_JUMP_HEIGHT=5,MAX_JUMP_HEIGHT=10,JUMP_RATE=5,BOUNCE_HEIGHT=2,LVL_LENGTH=50,MAX_VELOCITY=30,MIN_HEIGHT=-1,PLAYER_OFFSET=3,GRAVITY=10,FOV=95,VICTORY=!1,PAUSE=!1;